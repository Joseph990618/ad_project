<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Multiple Choice Questions</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@beta/dist/js.cookie.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    
    <style>
        body {
            background: rgb(1, 194, 194)
        }

        #scoreBoard {
            float: left;
            width: 18%;
            margin-left: 2.2%;
            background-color: azure;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            position: fixed;
        }

        .top-separator-line {
            border-top: 1px solid lightgrey;
        }

        #label1 {
            padding-top: 5px;
        }

        #question_title {
            width: 55%;
            margin: 20px auto;
            background-color: azure;
            padding: 20px;
            border-radius: 8px;
        }

        #title {
            margin-bottom: 10px;
            text-align: center;
        }

        #module_name {
            margin-bottom: 20px;
            text-align: center;
        }

        .spacing {
            padding-top: 15px;
        }

        .question {
            margin-bottom: 20px;
        }

        .options {
            margin: 1% 2%;
        }

        #btnRow {
            text-align: center;
        }

        .btn-danger,
        .btn-primary {
            font-size: 15px;
            font-weight: bold;
            width: 100px;
            height: 40px;
        }

        .btn-danger {
            margin-right: 10px;
        }

        .fixedElement {
            float: right;
            width: 18.5%;
            margin-top: 20px;
            margin-left: 79.5%;
            background-color: azure;
            padding: 20px;
            border-radius: 8px;
            position: fixed;
            top: 0;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="modal fade" id="myModal" name="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="exampleModalLongTitle">Welcome Player!</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div style="padding: 20px;">
                        <label for="name_label" style="font-size: 15px;">Please enter your name:</label>
                        <input type="text" id="player" style="border-radius: 8px; width: 180px;">
                        <label for="tips" style="font-size: 12px;">Tips: Stay anonymous, if you do not want to let other knows...</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="set_name()" data-dismiss="modal">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div id="scoreBoard">
        <label for=""><span style="font-weight: bold;">Highest Score <br> (Based on topic) </span><br></label>
        <div id="mydiv" class="col top-separator-line">
            <label id="label1" class="row" for="highest_score1">No record...</label>
            <label id="label2" class="row" for="highest_score2"></label>
            <label id="label3" class="row" for="highest_score3"></label>
        </div>
    </div>

    <div id="question_title">
        <h2 id="title">Multiple Choice Questions</h2>
        <h4 id="module_name">Topic: {{module.module_name}}</h4>

        <div class="question top-separator-line spacing">
            {% for qn in question|slice:"0:1" %}
                <p>1. {{qn.question_text}}</p>
                {% for c in choice|first %}
                    <fieldset class="options">
                        <input type="radio" name="group0" value="{{c.choice_text1}}"> {{c.choice_text1}}</input><br>
                        <input type="radio" name="group0" value="{{c.choice_text2}}"> {{c.choice_text2}}</input><br>
                        <input type="radio" name="group0" value="{{c.choice_text3}}"> {{c.choice_text3}}</input><br>
                        <input type="radio" name="group0" value="{{c.choice_text4}}"> {{c.choice_text4}}</input>
                        <input type="radio" id="answer0" value="{{c.answer_text}}" hidden></input>
                    </fieldset>
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"1:2" %}
                <p>2. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group1" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group1" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group1" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group1" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer1" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"2:3" %}
                <p>3. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group2" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group2" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group2" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group2" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer2" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"3:4" %}
                <p>4. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group3" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group3" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group3" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group3" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer3" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"4:5" %}
                <p>5. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group4" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group4" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group4" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group4" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer4" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"5:6" %}
                <p>6. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group5" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group5" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group5" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group5" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer5" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"6:7" %}
                <p>7. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group6" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group6" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group6" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group6" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer6" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"7:8" %}
                <p>8. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group7" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group7" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group7" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group7" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer7" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"8:9" %}
                <p>9. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group8" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group8" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group8" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group8" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer8" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="question">
            {% for qn in question|slice:"9:10" %}
                <p>10. {{qn.question_text}}</p>
                {% for c in choice %}
                    {% for i in c %}
                        {% if qn.id == i.id %}
                            <fieldset class="options">
                                <input type="radio" name="group9" value="{{i.choice_text1}}"> {{i.choice_text1}}</input><br>
                                <input type="radio" name="group9" value="{{i.choice_text2}}"> {{i.choice_text2}}</input><br>
                                <input type="radio" name="group9" value="{{i.choice_text3}}"> {{i.choice_text3}}</input><br>
                                <input type="radio" name="group9" value="{{i.choice_text4}}"> {{i.choice_text4}}</input>
                                <input type="radio" id="answer9" value="{{i.answer_text}}" hidden></input>
                            </fieldset>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </div>

        <div class="form_row top-separator-line spacing" id="btnRow">
            <button class="btn btn-danger" type="reset" onclick="resetAll()">Reset</button>
            <button class="btn btn-primary" onclick="returnScore(); submit();">Submit</button>
        </div>
    </div>

    <div class="fixedElement">
        <label for="player_name" style="font-weight: bold;">Player: <span id="player_name">Anonymous</span></label>
        <label class="col top-separator-line" for=""></label>
        <label id="score" for="score">Score: 0/10</label>
    </div>

    <script>
        function postJSON(csrftoken, url, postData, onsuccess) {
            $.ajax({
                type: 'POST',
                headers: { "X-CSRFToken": csrftoken },
                url: url,
                data: JSON.stringify(postData),
                success: function (data) {
                    onsuccess(data)
                },
                contentType: 'application/json;',
                dataType: 'json'
            });
        }
        
        var result = 0;

        function submit() {
            csrftoken = Cookies.get('csrftoken')

            var moduleId = "{{module.id}}"
            var playerName = $('#player_name').text();
            var finalResult = result.toString();

            json = {
                moduleId: moduleId,
                playerName: playerName,
                finalResult: finalResult,
            }
            onsuccess = (data) => {
                alert("Submit success!\nYour score is " + result + "/10")
            }
            postJSON(csrftoken, '{% url "submit_result" %}', json, onsuccess)
        }

        $(document).ready(function () {
            $(this).scrollTop(0);

            $("#myModal").modal().show();

            var count = 1
            {% for s in highestScore %}
            if (count <= 3) {
                if (count == 1 && {{ highestScore.count }} >= 1) {
                    $('#label1').text(count.toString() + "." + " {{s.player}} {{s.score}}/10");
                    count++;
                }
                else if (count == 2 && {{ highestScore.count }} >= 2) {
                    $('#label2').text(count.toString() + "." + " {{s.player}} {{s.score}}/10");
                    count++;
                    }
                else if (count == 3 && {{ highestScore.count }} == 3) {
                    $('#label3').text(count.toString() + "." + " {{s.player}} {{s.score}}/10");
                }
            }
            {% endfor %}
        });

        function set_name() {
            var player_name = $('#player').val()
            if (player_name.length == 0)
                player_name = "Anonymous";
            document.getElementById("player_name").innerHTML = player_name;
        }

        // store each selected choice
        var answer1 = $('#answer0').val()
        var answer2 = $('#answer1').val()
        var answer3 = $('#answer2').val()
        var answer4 = $('#answer3').val()
        var answer5 = $('#answer4').val()
        var answer6 = $('#answer5').val()
        var answer7 = $('#answer6').val()
        var answer8 = $('#answer7').val()
        var answer9 = $('#answer8').val()
        var answer10 = $('#answer9').val()

        var answers = [answer1, answer2, answer3, answer4, answer5, answer6, answer7, answer8, answer9, answer10]
        tot = answers.length;

        // compare the answer one by one
        function getCheckedValue(radioName) {
            var radios = document.getElementsByName(radioName); // Get radio group by-name
            for (var y = 0; y < radios.length; y++)
                if (radios[y].checked) return radios[y].value; // return the checked value
        }

        // store the score once the answer correct
        function getScore() {
            var score = 0;
            for (var i = 0; i < tot; i++)
                if (getCheckedValue("group" + i) === answers[i]) score += 1; // increment only
            result = score;
            return score;
        }

        function returnScore() {
            document.getElementById("score").innerHTML = "Score: " + getScore() + "/" + tot;
        }

        function resetAll() {
            window.location.reload();
        }   
    </script>
</body>

</html>